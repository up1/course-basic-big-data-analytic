[SERVICE]
    Parsers_File    /fluent-bit/etc/parsers.conf
    Grace           5
    Log_Level       info


# Subscribe to MQTT topic where the publisher sends messages
[INPUT]
    Name        mqtt
    Tag         sensors
    Listen      0.0.0.0
    Port        ${MQTT_PORT}


# Validate/transform: parse JSON payload and ensure schema
[FILTER]
    Name        parser
    Match       sensors
    Key_Name    message
    Parser      json


# Add a pipeline-level timestamp if not provided
# [FILTER]
#     Name        modify
#     Match       sensors
#     Add         pipeline,fluent-bit


# Forward to HTTP sink API as JSON
[OUTPUT]
    Name            stdout
    Match           sensors
    Format          json_lines

[OUTPUT]
    Name            http
    Match           sensors
    Host            api
    Port            ${API_PORT}
    URI             /ingest
    Format          json
    Retry_Limit     false